<!doctype html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/base}">
<head>
  <title>í™ˆ - Sec30 Music</title>
</head>
<body>
  <div layout:fragment="content">
    <!-- Hero Section -->
    <section class="hero">
      <div class="hero-card">
        <h1>Discover Weekly</h1>
        <p>ë‹¹ì‹ ë§Œì„ ìœ„í•œ ìƒˆë¡œìš´ ìŒì•… ë°œê²¬</p>
        <button class="play-btn" onclick="window.location.href='/tracks'">ì§€ê¸ˆ ë“£ê¸°</button>
      </div>
    </section>

    <!-- ì¸ê¸° íŠ¸ë™ ì„¹ì…˜ -->
    <section class="home-section">
      <div class="section-header">
        <h2 class="section-title">ì˜¤ëŠ˜ì˜ ì¸ê¸° íŠ¸ë™</h2>
        <a href="/tracks" class="section-link">ëª¨ë‘ ë³´ê¸° â†’</a>
      </div>

      <div class="track-grid" th:if="${tracks != null and !tracks.isEmpty()}">
        <div class="track-card" th:each="track, iterStat : ${tracks}"
             th:attr="data-track-id=${track.trackId},
                      data-track-name=${track.name},
                      data-artist=${track.artist},
                      data-album=${track.album},
                      data-image=${track.albumImage},
                      data-preview=${track.previewUrl}"
             onclick="playTrackDirectly(this)"
             style="cursor: pointer;">
          <div class="track-card-image">
            <img th:src="${track.albumImage}"
                 th:alt="${track.name}"
                 onerror="this.src='https://via.placeholder.com/300x300?text=No+Image'">
            <button class="track-card-play"
                    onclick="event.stopPropagation(); playTrackDirectly(this.parentElement.parentElement)"></button>
          </div>
          <div class="track-card-title" th:text="${track.name}">Track Name</div>
          <div class="track-card-artist" th:text="${track.artist}">Artist</div>
        </div>
      </div>

      <div class="empty-state" th:if="${tracks == null or tracks.isEmpty()}">
        <div class="empty-state-icon">ğŸµ</div>
        <div class="empty-state-title">íŠ¸ë™ì´ ì—†ìŠµë‹ˆë‹¤</div>
        <div class="empty-state-desc">ìŒì•…ì„ ê²€ìƒ‰í•˜ê±°ë‚˜ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ë¥¼ ë§Œë“¤ì–´ë³´ì„¸ìš”</div>
      </div>
    </section>

    <!-- ì¶”ì²œ ë¯¹ìŠ¤ ì„¹ì…˜ -->
    <section class="recommended" th:if="${mixes != null and !mixes.isEmpty()}">
      <h2>íšŒì›ë‹˜ì„ ìœ„í•œ ë§ì¶¤ ë¯¹ìŠ¤</h2>
      <div class="cards">
        <div class="card" th:each="mix : ${mixes}">
          <img th:src="${mix.imageUrl}"
               th:alt="${mix.title}"
               onerror="this.src='https://via.placeholder.com/300x300?text=Mix'">
          <div class="card-title" th:text="${mix.title}">Mix Title</div>
          <div class="card-subtitle" th:text="${mix.description}">Mix Description</div>
        </div>
      </div>
    </section>
  </div>

  <th:block layout:fragment="scripts">
    <script>
      function playTrackDirectly(element) {
        alert('Function called!'); // í…ŒìŠ¤íŠ¸ìš©
        console.log('=== playTrackDirectly called ===');
        console.log('Element:', element);

        const trackData = {
          trackId: element.getAttribute('data-track-id'),
          name: element.getAttribute('data-track-name'),
          artist: element.getAttribute('data-artist'),
          album: element.getAttribute('data-album'),
          albumImage: element.getAttribute('data-image'),
          imageUri: element.getAttribute('data-image'),
          previewUrl: element.getAttribute('data-preview'),
          spotifyId: element.getAttribute('data-track-id')
        };

        console.log('Track data extracted:', trackData);
        console.log('Preview URL:', trackData.previewUrl);
        console.log('Preview URL type:', typeof trackData.previewUrl);
        console.log('Preview URL length:', trackData.previewUrl ? trackData.previewUrl.length : 0);

        // ëª¨ë“  íŠ¸ë™ ì¹´ë“œ ìˆ˜ì§‘
        const allTrackCards = document.querySelectorAll('.track-card');
        const allTracksData = Array.from(allTrackCards).map(card => ({
          trackId: card.getAttribute('data-track-id'),
          name: card.getAttribute('data-track-name'),
          artist: card.getAttribute('data-artist'),
          album: card.getAttribute('data-album'),
          albumImage: card.getAttribute('data-image'),
          imageUri: card.getAttribute('data-image'),
          previewUrl: card.getAttribute('data-preview'),
          spotifyId: card.getAttribute('data-track-id')
        }));

        console.log('Total tracks in playlist:', allTracksData.length);

        if (typeof musicPlayer !== 'undefined') {
          musicPlayer.playTrack(trackData, allTracksData);
        } else {
          console.error('musicPlayer not found!');
        }
      }
    </script>
  </th:block>
</body>
</html>

